(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{380:function(e,n,s){"use strict";s.r(n);var a=s(22),t=Object(a.a)({},(function(){var e=this,n=e.$createElement,s=e._self._c||n;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"封装同步方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#封装同步方法"}},[e._v("#")]),e._v(" 封装同步方法")]),e._v(" "),s("h4",{attrs:{id:"dbconnect-js"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dbconnect-js"}},[e._v("#")]),e._v(" dbconnect.js")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("const mysql = require('mysql')\n\n// 创建数据池\nconst pool  = mysql.createPool({\n  host     : '127.0.0.1',   // 数据库地址\n  user     : 'root',    // 数据库用户\n  password : '123456',   // 数据库密码\n  database : 'mysql'  // 选中数据库\n})\n\n// 在数据池中进行会话操作\nfunction query( sql, values ) {\n    // 返回一个 Promise\n    return new Promise(( resolve, reject ) => {\n      pool.getConnection(function(err, connection) {\n        if (err) {\n          reject( err )\n        } else {\n          connection.query(sql, values, ( err, rows) => {\n  \n            if ( err ) {\n              reject( err )\n            } else {\n              resolve( rows )\n            }\n            // 结束会话\n            connection.release()\n          })\n        }\n      })\n    })\n  }\n\nmodule.exports = query\n\n")])])]),s("h2",{attrs:{id:"使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[e._v("#")]),e._v(" 使用")]),e._v(" "),s("h4",{attrs:{id:"函数外部使用-需要使用-then处理promise"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#函数外部使用-需要使用-then处理promise"}},[e._v("#")]),e._v(" 函数外部使用,需要使用.then处理promise")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("var sql=\"insert into auth(username,ipaddress,password)value(?,?,?)\"\nvar params=['zhang666','127.9.9.9','123123123123123123']\nquery(sql,params).then(data=>{\n    console.log(data);\n    /*\n    OkPacket {\n        fieldCount: 0,\n        affectedRows: 1,\n        insertId: 7,\n        serverStatus: 2,\n        warningCount: 0,\n        message: '',\n        protocol41: true,\n        changedRows: 0\n    }\n    */\n    或者\n    /*\n    [{'username':'zhangsan','age':12,.....},{},......]\n    */\n})\n")])])]),s("h4",{attrs:{id:"函数内部使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#函数内部使用"}},[e._v("#")]),e._v(" 函数内部使用")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("app.get('/', async (req, res)=>{\n    var sql=\"select * from mysql.user\"\n    var params=[]\n    var data=await query(sql,params)  //在其他函数中使用，可以直接获取数据,express举例\n    ......\n})\n")])])])])}),[],!1,null,null,null);n.default=t.exports}}]);